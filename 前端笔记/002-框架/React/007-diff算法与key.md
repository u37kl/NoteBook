# diff算法和key

> diff算法是React提出的虚拟DOM比对算法，实现以最小的操作代价来更新页面。diff算法的目的就是实现从一个组件树转换成另一颗组件树所花费的最小操作代价。

```jsx
// 原组件树
<App>
  	<Header></Header>
		<Content>
      <div key='1'>
        <button>点击</button>
      </div>
      <div key='2'></div>
  	</Content>
  	<Footer></Footer>
</App>

// 修改后的组件树
<App>
  	<Header></Header>
		<Content>
      <section key='1'>
        <button>点击</button>
      </section>
      <div key='3'></div>
      <div key='2'></div>
  	</Content>
  	<Footer></Footer>
</App>
```

> 实例中组件改变了哪些：
>
> 1. Content组件的第一个组件从div变成了section
> 2. Content组件新增了一个div组件
> 3. key=2的div组件位置排在第三。
>
> diff算法比对说明：
>
> 1. 首先找发生更改的子组件树的根节点，也就是上面的`Content组件`，生成新的组件树
> 2. 按照树的前序遍历进行比对：
>    1. 判断当前节点更新前后是否类型一直，如果类型不一致，则直接删除该节点，例如上面示例中secion与div不是同一类型， 因此直接将div组件卸载掉，即销毁(该组件以及该组件的子组件都会触发(componentWillUnmount方法)。
>    2. 接着判断第二个节点，是否类型一致，如果类型一致，则判断key值是否相同，
>       1. 如果key相同，则查看组件是否发生改动，如果改动则更新真实DOM，如果没有改动则不对真实DOM做任何操作。
>    3. 判断第三个节点，旧树没有新树有，查看`这个类型的节点的key值`在旧树中的兄弟节点中是否存在，如果存在则复用该节点，使用该节点对应的真实DOM。



## 组件的key属性

> 组件的key属性是用来辅助diff算法的，在进行新旧树比对中，只有key和类型存在，则直接复用，大大提高性能。
>
> key属性的使用注意：
>
> 1. key作为组件的属性，是无法通过组件的props属性拿到的。
> 2. key只适用于兄弟组件，也就是说在兄弟组件中key必须唯一，父子组件或者其他关系的组件key没有唯一性限制。
> 3. key的出现是为了提高复用效率，使用场景：
>    1. 如果某个组件有多个类型相同的子组件时，需要使用key，例如列表`<li>`。
>    2. 子组件在更新后会发生位置的改变时，需要使用key，实现复用。